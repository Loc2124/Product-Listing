<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Listing</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      crossorigin="anonymous"
    />
    <style type="text/css">
      body {
        background-color: #f8f9fa;
      }
      .table {
        width: 100%;
      }
      .table th,
      .table td {
        vertical-align: middle;
        text-align: left;
      }
      #loadMore {
        width: 200px;
        margin: 20 auto;
        background-color: #007bff;
        color: white;
        height: 50px;
        line-height: 50px;
        border: 0px;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>
          <th scope="col">description</th>
          <th scope="col">Price</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row">1</th>
          <td>San pham 1</td>
          <td>Day la san pham 1</td>
          <td>10.000.000</td>
        </tr>
      </tbody>
    </table>
    <div id="pagination-controls">
      <button class="btn btn-secondary" id="prevPage" disabled>Previous</button>
      <span
        >Page <span id="current-page">1</span> of
        <span id="total-pages">2</span></span
      >
      <button class="btn btn-secondary" id="nextPage">Next</button>
    </div>
    <button class="btn btn-primary" id="loadMore">Load More</button>
  </body>

  <script
    src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"
  ></script>
  <script type="text/javascript">
    $(document).ready(function () {
      let pagesize = 9; // Số sản phẩm trên mỗi trang
      let page = 1; // Bắt đầu từ trang 1
      let stt = 1; // Số thứ tự sản phẩm

      function loadProducts() {
        console.log("Loading products for page:", page);
        $.ajax({
          url: `http://127.0.0.1:5063/api/Products?page=${page}&pageSize=${pagesize}`, // Gửi tham số page và pageSize
          type: "GET",
          dataType: "json",
          success: function (data) {
            console.log(data); // Kiểm tra dữ liệu trả về từ API
            let products = data.data; // Truy cập vào danh sách sản phẩm
            let tableBody = $("table tbody");

            // Đặt lại số thứ tự khi chuyển trang
            stt = (page - 1) * pagesize + 1;

            // Xóa dữ liệu cũ trước khi thêm dữ liệu mới
            tableBody.empty();

            if (!Array.isArray(products)) {
              console.error("Products is not an array:", products);
              return;
            }

            products.forEach(function (product) {
              stt++;
              let row = `<tr>
                            <th scope="row">${stt}</th>
                            <td>${product.name}</td>
                            <td>${product.description}</td>
                            <td>${product.price}</td>
                        </tr>`;
              tableBody.append(row);
            });

            // Cập nhật thông tin phân trang
            $("#current-page").text(data.page);
            $("#total-pages").text(data.totalPages);

            // Vô hiệu hóa nút Previous nếu đang ở trang đầu tiên
            if (page === 1) {
              $("#prevPage").prop("disabled", true);
            } else {
              $("#prevPage").prop("disabled", false);
            }

            // Vô hiệu hóa nút Next nếu đang ở trang cuối cùng
            if (page === data.totalPages) {
              $("#nextPage").prop("disabled", true);
            } else {
              $("#nextPage").prop("disabled", false);
            }
          },
          error: function () {
            alert("Error loading products.");
          },
        });
      }

      // Xử lý khi nhấn nút Previous
      $("#prevPage").click(function () {
        if (page > 1) {
          page--;
          loadProducts();
        }
      });

      // Xử lý khi nhấn nút Next
      $("#nextPage").click(function () {
        page++;
        loadProducts();
      });

      // Tải dữ liệu trang đầu tiên khi trang được tải
      loadProducts();
    });
  </script>
</html>
